# Sagan microsoft_intune.rules
# Copyright (c) 2009-2024. Quadrant Information Security <www.quadrantsec.com>
# All rights reserved.
#
# Please submit any custom rules or ideas to sagan-submit@quadrantsec.com or the sagan-sigs mailing list
#
#*************************************************************
#  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
#  following conditions are met:
#
#  * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
#    disclaimer.
#  * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the
#    following disclaimer in the documentation and/or other materials provided with the distribution.
#  * Neither the name of the nor the names of its contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#*************************************************************

# rules by "Bryant Smith" <bsmith@quadrantsec.com>
# 07/21/2025

alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] List MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","List MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017006; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Get MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Get MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017007; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Create MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Create MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017008; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Delete MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Delete MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017009; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Update MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Update MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017010; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Retire MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Retire MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017011; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Wipe MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Wipe MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017012; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] resetPasscode MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","resetPasscode MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017013; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] remoteLock MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","remoteLock MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017014; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] requestRemoteAssistance MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","requestRemoteAssistance MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017015; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] disableLostMode MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","disableLostMode MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017016; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] locateDevice MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","locateDevice MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017017; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] bypassActivationLock MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","bypassActivationLock MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017018; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] rebootNow MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","rebootNow MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017019; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] shutDown MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","shutDown MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017020; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] recoverPasscode MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","recoverPasscode MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017021; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] cleanWindowsDevice MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","cleanWindowsDevice MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017022; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] logoutSharedAppleDeviceActiveUser MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","logoutSharedAppleDeviceActiveUser MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017023; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] deleteUserFromSharedAppleDevice MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","deleteUserFromSharedAppleDevice MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017024; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] syncDevice MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","syncDevice MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017025; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] windowsDefenderScan MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","windowsDefenderScan MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017026; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] windowsDefenderUpdateSignatures MangedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","windowsDefenderUpdateSignatures MangedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017027; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] updateWindowsDeviceAccount ManagedDevice Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","updateWindowsDeviceAccount ManagedDevice"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017028; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Create ClientCertificate Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Create ClientCertificate"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017029; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] CreateImportedWindowsAutopilotDeviceIdentity ImportedWindowsAutopilotDeviceIdentity Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","CreateImportedWindowsAutopilotDeviceIdentity ImportedWindowsAutopilotDeviceIdentity"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017030; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Delete MobileApp Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Delete MobileApp"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017031; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Patch MobileApp Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","Patch MobileApp"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017032; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] SyncWindowsAutopilotDevices WindowsAutopilotSettings Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","SyncWindowsAutopilotDevices WindowsAutopilotSettings"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017033; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] UnblockUserlessEnrollment WindowsAutopilotDeviceIdentity Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","UnblockUserlessEnrollment WindowsAutopilotDeviceIdentity"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017034; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] UpdateDeviceProperties WindowsAutopilotDeviceIdentity Operation Log Detected"; program:azureEventHub; json_content:".category","AuditLogs"; json_content:".operationName","UpdateDeviceProperties WindowsAutopilotDeviceIdentity"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017035; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] DeviceCompliance Operation Log Detected"; program:azureEventHub; json_content:".category","DeviceComplianceOrg"; json_content:".operationName","DeviceCompliance"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017036; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Devices Operation Log Detected"; program:azureEventHub; json_content:".category","Devices"; json_content:".operationName","Devices"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017037; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
#alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Compliance Operation Log Detected"; program:azureEventHub; json_content:".category","OperationalLogs"; json_content:".operationName","Compliance"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017038; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] Enrollment Operation Log Detected"; program:azureEventHub; json_content:".category","OperationalLogs"; json_content:".operationName","Enrollment"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017039; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
alert any $HOME_NET any -> $HOME_NET any (msg:"[MICROSOFT_INTUNE] ESPEnrollment Operation Log Detected"; program:azureEventHub; json_content:".category","OperationalLogs"; json_content:".operationName","ESPEnrollment"; parse_src_ip:1; normalize; reference:url,https://learn.microsoft.com/en-us/graph/api/resources/intune-devices-manageddevice?view=graph-rest-1.0; classtype:system-event; sid:5017040; rev:1; metadata:created_at 2024_01_20, updated_at 2024_01_20;)
